{% extends "header.html" %}

{% block title %} Scanner {% endblock %}

{% block body %}
	<br>
	<div align="center">
		<div style="display: inline-block; text-align: left;">
			<h7> 
				BTC Change (24h):
				<h7 id="btc-change-24h"> </h7> 
			</h7>
		
			<table class="table-bordered" style="border-collapse: collapse;">
				<thead>
					<tr>
						<th> Market </th>
						<th> Base Volume (24h) </th>
						<th> Bid </th>
						<th> Ask </th>
						<th> Last </th>
						<th> Previous Day </th>
						<th> % Change (24h) </th>
						<th> % Change (12h) </th>
						<th> % Change (6h) </th>
						<th> RSI </th>
					</tr>
				</thead>

				<tbody id="table-body" />
			</table>
		</div>
	</div>
{% endblock %}

{% block javascript %}
	<script type="text/javascript">

		// URLs 
		var updateTableListeners = []

		function updateTable() {
			$.ajax({
				url: "{% url 'scan' %}",
				type: "GET",
				dataType: "json",
				success: function(response) {

					var rowData = response['table'];

					var rowHtml = "";

					for (i = 0; i < rowData.length; i++) {
						var row = rowData[i];

						rowHtml += "<tr bgcolor='" + (i % 2 == 0 ? "WhiteSmoke" : "White") + "'>";
						rowHtml += "<td>" + row["market"] + "</td>";
						rowHtml += "<td>" + row["base_volume"].toFixed(3) + "</td>";
						rowHtml += "<td>" + row["bid"].toFixed(8) + "</td>";
						rowHtml += "<td>" + row["ask"].toFixed(8) + "</td>";
						rowHtml += "<td>" + row["last"].toFixed(8) + "</td>";
						rowHtml += "<td>" + row["previous_day"].toFixed(8) + "</td>";

						change24H = row["change_24h"]
						rowHtml += "<td><font color='" + (change24H >= 0 ? "green" : "red") + "'>" + (change24H * 100).toFixed(1) + "%" + "</font></td>";

						change12H = row["change_12h"]
						rowHtml += "<td><font color='" + (change12H >= 0 ? "green" : "red") + "'>" + (change12H * 100).toFixed(1) + "%" + "</font></td>";

						change6H = row["change_6h"]
						rowHtml += "<td><font color='" + (change6H >= 0 ? "green" : "red") + "'>" + (change6H * 100).toFixed(1) + "%" + "</font></td>";

						rsi = row["rsi"]
						if (rsi >= 70 || rsi <= 25)
							rowHtml += "<td><font color='" + (rsi >= 70 ? "green" : "red") + "'>" + rsi.toFixed(2) + "</font></td>";
						else
							rowHtml += "<td>" + rsi.toFixed(2) + "</td>";

						rowHtml += "</tr>";
					}

					$("#table-body").empty();
					$("#table-body").html(rowHtml);
				}
			})
		};

		function updateBTCPriceChange() {
			$.ajax({
				url: "https://api.coinmarketcap.com/v1/ticker/bitcoin/",
				type: "GET",
				dataType: "json",
				success: function(response) {
					btcChange24h = response[0]["percent_change_24h"]
					$("#btc-change-24h").empty();

					html = "<font color='" + (btcChange24h >= 0 ? "green" : "red") + "'>" + btcChange24h + "%" + "</font>";
					$("#btc-change-24h").html(html)
				}
			})
		};

		(function update() {
			updateTable();
			updateBTCPriceChange();
			setTimeout(update, 10000);
		})();

		

	</script>
{% endblock %}