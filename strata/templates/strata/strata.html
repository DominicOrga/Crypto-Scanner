{% extends "header.html" %}

{% block title %} Strategy A {% endblock %}

{% block navbar %}
	<li><a href="{% url 'scanner' %}">Scanner</a></li>
	<li class="active"><a href="{% url 'strata' %}">Strategy A</a></li>
{% endblock %}

{% block body %}

	<div style="height: 200%; background-color: #263238; color: Gainsboro" align="center">
		<div style="width: 80%; margin-top: -25px">
			<div style="margin-left: auto; margin-right: auto; margin-top: 25px; margin-bottom: 15px;  text-align: left; display: inline-block;" class="container-fluid">

				<p> 
					This strategy is an implementation of the bottom reversal strategy, with the premise that a bullish security that suddenly oversold itself would likely bounce back up. 
				</p> 

				<ol>
					<p>
						<i>  Buy Signals: </i>
						<li> If altcoin RSI &le; 25. </li>
						<li> If altcoin 24h percent change &ge; 5% and 12h percent change &ge; 2.5% and 6h percent change &ge; 0%. </li>
					</p>
				</ol>
			</div>
		</div>
	</div>

	<br>

	<div align="center">
		<div style="text-align: left; margin-right: 5%; margin-left: 5%">
			<p class="no-linebreak" style="font-size: 3em;"> 
				RECENT MARKETS
			</p>
		
			<div style="text-align: right;">
				<div style="overflow-x:auto;">
					<table class="table table-bordered table-condensed table-striped">
						<thead>
							<tr>
								<th> Datetime Created </th>
								<th> Market </th>
								<th> Base Volume (24h) </th>
								<th> Bid </th>
								<th> Ask </th>
								<th> Last </th>
								<th> Previous Day </th>
								<th> % Change (24h) </th>
								<th> % Change (12h) </th>
								<th> % Change (6h) </th>
								<th> RSI </th>
							</tr>
						</thead>

						<tbody id="table-body" />
					</table> 
				</div>
			</div>
		</div>
	</div>
	</div>

{% endblock %}

{% block javascript %}
	<script type="text/javascript">
		
		function updateTables() {
			$.ajax({
				url: "{% url 'strata_markets' %}",
				type: "GET",
				dataType: "json",
				success: function(response) {
					html = "";

					markets = response["markets"];

					if (markets.length == 0) 
						html = "<tr><td colspan=50> No Data to Display :( </td></tr>";
		
					else {

						var recentMarkets = []

						for (i = 0; i < markets.length; i++) {
							var market = markets[i];

							if (!market["is_recent"] || recentMarkets.indexOf(market["market"]) != -1)
								continue;

							recentMarkets.push(market["market"]);

							html += "<tr>";
							html += "<td>" + market["datetime_formatted"] + "</td>";
							html += "<td>" + market["market"] + "</td>";
							html += "<td>" + market["base_volume"].toFixed(3) + "</td>";
							html += "<td>" + market["bid"].toFixed(8) + "</td>";
							html += "<td>" + market["ask"].toFixed(8) + "</td>";
							html += "<td>" + market["last"].toFixed(8) + "</td>";
							html += "<td>" + market["previous_day"].toFixed(8) + "</td>";

							change24H = market["change_24h"]
							html += "<td><font color='" + (change24H >= 0 ? "green" : "red") + "'>" + (change24H * 100).toFixed(1) + "%" + "</font></td>";

							change12H = market["change_12h"]
							html += "<td><font color='" + (change12H >= 0 ? "green" : "red") + "'>" + (change12H * 100).toFixed(1) + "%" + "</font></td>";

							change6H = market["change_6h"]
							html += "<td><font color='" + (change6H >= 0 ? "green" : "red") + "'>" + (change6H * 100).toFixed(1) + "%" + "</font></td>";

							rsi = market["rsi"]
							if (rsi >= 70 || rsi <= 25)
								html += "<td><font color='" + (rsi >= 70 ? "green" : "red") + "'>" + rsi.toFixed(2) + "</font></td>";
							else
								html += "<td>" + rsi.toFixed(2) + "</td>";

							html += "</tr>";
						}

						if (recentMarkets.length == 0)
							html = "<tr><td colspan=50> No Data to Display :( </td></tr>";
					}

					// for (i = 0; i < markets.length; i++)
					// 	console.log(markets[i]["is_recent"]);

					$("#table-body").empty();
					$("#table-body").html(html);
				}
			});
		};

		periodicFunctions.push(updateTables);

	</script>


{% endblock %}